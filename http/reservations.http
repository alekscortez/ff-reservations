### Reservations API (Staff/Admin)

### Create reservation from hold
# Preconditions:
# 1) Create hold first in holds.http
# 2) Replace holdId with returned item.holdId
POST {{baseUrl}}/reservations
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-02-14",
  "tableId": "C108",
  "holdId": "d9dfa735-3be2-40c8-8fbd-e5224d5d1998",
  "customerName": "John Doe",
  "phone": "+19561231234",
  "depositAmount": 0,
  "paymentStatus": "PENDING",
  "paymentDeadlineAt": "2026-03-22T00:00:00",
  "paymentDeadlineTz": "America/Chicago"
}

###

### List reservations by event date
GET {{baseUrl}}/reservations?eventDate=2026-02-14
Authorization: Bearer {{accessToken}}

###

### Add payment to reservation
# Replace reservationId with returned item.reservationId from create call
@reservationId = 69f8985f-589f-46f0-a218-3434c157c2a2
PUT {{baseUrl}}/reservations/{{reservationId}}/payment
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-02-14",
  "amount": 250,
  "method": "cash",
  "note": "Paid at door"
}

###

### Add Square payment to reservation (Phase 1)
### sourceId must come from Square Web Payments SDK tokenization on frontend.
POST {{baseUrl}}/reservations/{{reservationId}}/payment/square
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-02-14",
  "amount": 250,
  "sourceId": "cnon:card-nonce-ok",
  "note": "Square terminalless charge",
  "idempotencyKey": "c57cd611-e4f5-4f7c-b216-b5a5b131cdb5"
}

###

### Create Square payment link (invoice-style flow)
### amount is optional; if omitted, backend uses full remaining balance.
POST {{baseUrl}}/reservations/{{reservationId}}/payment-link/square
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-02-14",
  "amount": 70,
  "note": "Table hold payment link",
  "idempotencyKey": "c57cd611-e4f5-4f7c-b216-b5a5b131cdb5"
}

###

### Create Square payment link and send via backend SMS (Phase 1)
### Reservation phone must be valid E.164 (example: +19561231234).
POST {{baseUrl}}/reservations/{{reservationId}}/payment-link/square/sms
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-02-14",
  "amount": 70,
  "note": "Table payment link via SMS",
  "idempotencyKey": "3a937807-febb-418d-a86b-41a677d94635"
}

###

### Cancel reservation
PUT {{baseUrl}}/reservations/{{reservationId}}/cancel
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "eventDate": "2026-03-21",
  "tableId": "A15",
  "cancelReason": "Client no-show"
}
