<header class="fixed inset-x-0 top-0 z-20 flex h-14 w-full items-center justify-between gap-2 border-b border-brand-100 bg-white px-3 py-2 md:h-16 md:gap-3 md:px-5 md:py-3">
  <div class="flex min-w-0 items-center gap-2">
    <button
      class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-brand-200 text-brand-900 md:hidden"
      type="button"
      (click)="toggleMobileNav()"
      aria-label="Open menu"
    >
      <span class="flex flex-col gap-1" aria-hidden="true">
        <span class="h-0.5 w-5 rounded-full bg-brand-900"></span>
        <span class="h-0.5 w-5 rounded-full bg-brand-900"></span>
        <span class="h-0.5 w-5 rounded-full bg-brand-900"></span>
      </span>
    </button>

    <a class="inline-flex items-center gap-2 font-semibold text-brand-900" routerLink="/home">
      <img class="h-7 w-7 object-contain" src="/assets/ff-logo.svg" alt="Famoso Fuego" />
      <span class="hidden text-sm tracking-wide lg:inline">Reservation System</span>
    </a>

    <div
      class="ml-1 inline-flex min-w-0 items-center gap-1 rounded-full border border-brand-100 bg-brand-50 px-2 py-1"
      *ngIf="isAuthenticated$ | async"
    >
      <span class="max-w-[80px] truncate text-[11px] font-semibold text-brand-900 md:max-w-[170px]">{{ contextLabel() }}</span>
      <span class="text-[10px] uppercase tracking-[0.08em] text-brand-600">{{ contextDateLabel() }}</span>
    </div>
  </div>

  <div class="flex items-center gap-2">
    <ng-container *ngIf="isAuthenticated$ | async; else loggedOut">
      <button
        *ngIf="isStaffOrAdmin"
        type="button"
        class="relative inline-flex h-9 items-center justify-center rounded-lg border border-brand-200 px-2.5 text-xs font-semibold text-brand-800"
        (click)="toggleQuickActions()"
        aria-label="Quick actions"
      >
        Quick
        <span
          *ngIf="urgentPaymentCount > 0"
          class="absolute -right-1 -top-1 inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-danger-700 px-1 text-[10px] font-semibold text-white"
        >
          {{ urgentPaymentCount }}
        </span>
      </button>

      <a
        *ngIf="isStaffOrAdmin && !isOnNewReservationRoute()"
        routerLink="/staff/reservations/new"
        [queryParams]="newReservationQueryParams()"
        class="inline-flex h-9 items-center justify-center rounded-lg bg-brand-900 px-3 text-xs font-semibold text-white transition-colors hover:bg-brand-800"
      >
        <span *ngIf="urgentPaymentCount > 0; else newReservationCta">
          <span class="md:hidden">Pay ({{ urgentPaymentCount }})</span>
          <span class="hidden md:inline">Take Payment ({{ urgentPaymentCount }})</span>
        </span>
        <ng-template #newReservationCta>
          <span class="md:hidden">+ New</span>
          <span class="hidden md:inline">+ New Reservation</span>
        </ng-template>
      </a>
    </ng-container>

    <ng-template #loggedOut>
      <button class="rounded-lg bg-brand-900 px-3 py-2 text-xs font-semibold text-white" type="button" (click)="login()">
        Log in
      </button>
    </ng-template>
  </div>
</header>

<div class="fixed inset-0 z-40" *ngIf="isQuickActionsOpen" (click)="closeQuickActions()"></div>

<div class="fixed inset-0 z-50 flex items-end justify-center p-0 sm:items-start sm:justify-end sm:p-4 sm:pt-[68px]" *ngIf="isQuickActionsOpen">
  <section class="w-full rounded-t-2xl border border-brand-100 bg-white p-4 shadow-2xl sm:w-[360px] sm:rounded-2xl">
    <div class="flex items-center justify-between gap-3">
      <h3 class="text-sm font-semibold text-brand-900">Quick Actions</h3>
      <button
        type="button"
        class="inline-flex h-8 w-8 items-center justify-center rounded-full border border-brand-200 text-xs text-brand-700"
        (click)="closeQuickActions()"
        aria-label="Close quick actions"
      >
        âœ•
      </button>
    </div>

    <div class="mt-3 rounded-lg border border-brand-100 bg-brand-50 px-3 py-2 text-xs text-brand-700">
      <p class="font-semibold text-brand-900">{{ contextLabel() }}</p>
      <p>{{ contextDateLabel() }}</p>
    </div>

    <div class="mt-3 grid gap-2">
      <a
        *ngFor="let action of quickActions()"
        [routerLink]="[action.route]"
        [queryParams]="action.queryParams ?? null"
        class="inline-flex h-11 items-center justify-between rounded-lg border border-brand-200 px-3 text-sm font-semibold text-brand-900"
        (click)="closeQuickActions()"
      >
        <span>{{ action.label }}</span>
        <span
          *ngIf="action.badge"
          class="inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-danger-700 px-1 text-[10px] font-semibold text-white"
        >
          {{ action.badge }}
        </span>
      </a>
    </div>
  </section>
</div>
