<section class="mx-auto min-h-screen w-full max-w-xl px-4 py-8">
  <article class="rounded-2xl border border-brand-200 bg-white p-5 shadow-sm">
    <img src="/assets/ff-logo.svg" alt="Fuego Western Club logo" class="h-12 w-auto" />
    <h1 class="mt-3 text-2xl font-semibold text-brand-900">Complete Payment</h1>

    <p class="mt-2 text-sm text-brand-600" *ngIf="loading">Loading payment session…</p>
    <p class="mt-2 text-sm text-danger-700" *ngIf="error">{{ error }}</p>
    <p class="mt-2 text-sm text-success-700" *ngIf="notice">{{ notice }}</p>

    <ng-container *ngIf="session as s">
      <div class="mt-4 rounded-xl border border-brand-200 bg-brand-50 p-3">
        <p class="text-[11px] uppercase tracking-[0.12em] text-brand-500">Reservation</p>
        <p class="mt-1 text-sm font-semibold text-brand-900">
          {{ formatEventDateLong(s.reservation.eventDate) }} · Table {{ s.reservation.tableId || '—' }}
        </p>
        <p class="mt-1 text-sm text-brand-700">{{ s.reservation.customerName || 'Guest' }}</p>
      </div>

      <div class="mt-3 grid grid-cols-2 gap-2">
        <div class="rounded-xl border border-brand-200 bg-white p-3">
          <p class="text-[11px] uppercase tracking-[0.12em] text-brand-500">Due</p>
          <p class="mt-1 text-lg font-semibold text-brand-900">${{ s.reservation.chargeAmount | number:'1.2-2' }}</p>
        </div>
        <div class="rounded-xl border border-brand-200 bg-white p-3">
          <p class="text-[11px] uppercase tracking-[0.12em] text-brand-500">Expires</p>
          <p class="mt-1 text-sm font-medium text-brand-900">{{ expiresAtLabel() }}</p>
        </div>
      </div>

      <div class="mt-7 flex min-h-[72px] items-start justify-center" *ngIf="!result" #cashAppHost></div>
      <p class="mt-2 text-center text-xs text-brand-500" *ngIf="!result">
        If payment options do not appear, tap Refresh.
      </p>

      <div class="mt-4 rounded-xl border border-success-200 bg-success-50 p-3" *ngIf="result as r">
        <p class="text-sm font-semibold text-success-800">Payment complete</p>
        <p class="mt-1 text-xs text-success-700">
          {{ r.reservation.paymentStatus }} · Paid ${{ r.reservation.paid | number:'1.2-2' }}
        </p>
        <a
          *ngIf="r.square.receiptUrl"
          [href]="r.square.receiptUrl || ''"
          target="_blank"
          rel="noopener"
          class="mt-2 inline-flex rounded-lg border border-success-300 px-3 py-1.5 text-xs font-semibold text-success-800"
        >
          View receipt
        </a>
      </div>

      <div class="mt-4 flex justify-center gap-2" *ngIf="!result">
        <button
          type="button"
          class="h-10 rounded-lg border border-brand-200 px-3 text-xs font-semibold text-brand-800 disabled:opacity-50"
          (click)="refresh()"
          [disabled]="loading || preparing || processing"
        >
          Refresh
        </button>
      </div>
    </ng-container>
  </article>
</section>
