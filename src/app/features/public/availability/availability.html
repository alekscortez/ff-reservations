<section class="mx-auto w-full max-w-6xl px-3 pb-8 pt-3 md:px-5 md:pt-5">
  <header class="rounded-2xl border border-brand-100 bg-white p-3 shadow-sm md:p-4">
    <div class="flex items-center">
      <img class="h-24 w-24 object-contain md:h-28 md:w-28" src="/assets/ff-logo.svg" alt="Famoso Fuego logo" />
    </div>
    <h1 class="mt-0 text-2xl font-semibold text-brand-900 md:text-3xl">Live Table Availability</h1>
    <p class="mt-2 text-sm text-brand-600">
      Pick your preferred table and reply with the table number to staff. Reservation is confirmed after payment.
    </p>

    <div class="mt-3 grid gap-3 md:grid-cols-[1fr_auto] md:items-end" *ngIf="data as d">
      <label class="grid gap-1 text-xs text-brand-600">
        Choose your night
        <select
          class="h-10 rounded-lg border border-brand-200 px-3 text-sm"
          [value]="d.event.eventDate"
          (change)="onEventDateChange($any($event.target).value)"
        >
          <option *ngFor="let item of d.events" [value]="item.eventDate">
            {{ item.eventDate }} · {{ item.eventName }}
          </option>
        </select>
      </label>

      <article class="rounded-xl border border-brand-200 bg-brand-50 px-3 py-2">
        <p class="text-[11px] uppercase tracking-[0.12em] text-brand-600">Updated</p>
        <p class="text-sm font-semibold text-brand-900">{{ asOfLabel() }} · {{ d.refreshSeconds }}s</p>
      </article>
    </div>
  </header>

  <section class="mt-4 rounded-2xl border border-brand-100 bg-white p-3 shadow-sm md:p-4" *ngIf="data as d">
    <div class="flex flex-wrap items-center justify-between gap-2">
      <div class="inline-flex rounded-full border border-brand-200 bg-white p-1">
        <button
          type="button"
          class="rounded-full px-3 py-1 text-xs font-semibold"
          [ngClass]="isViewMode('MAP') ? 'bg-brand-900 text-white' : 'text-brand-700'"
          (click)="setViewMode('MAP')"
        >
          Map
        </button>
        <button
          type="button"
          class="rounded-full px-3 py-1 text-xs font-semibold"
          [ngClass]="isViewMode('LIST') ? 'bg-brand-900 text-white' : 'text-brand-700'"
          (click)="setViewMode('LIST')"
        >
          List
        </button>
      </div>

      <label class="inline-flex items-center gap-2 text-xs text-brand-700">
        <input type="checkbox" class="h-4 w-4 rounded border-brand-300" [formControl]="availableOnly" />
        Show available only
      </label>
    </div>

    <div class="mt-3" *ngIf="isViewMode('MAP'); else listView">
      <div class="mb-3 flex flex-wrap gap-2" *ngIf="sectionLegend().length">
        <article
          class="inline-flex items-center gap-2 rounded-full border border-brand-200 bg-brand-50 px-2.5 py-1 text-[11px] font-semibold text-brand-800"
          *ngFor="let item of sectionLegend()"
        >
          <span class="h-2.5 w-2.5 rounded-full" [style.background-color]="item.color"></span>
          <span>Section {{ item.section }}</span>
          <span class="text-brand-900">{{ item.priceLabel }}</span>
        </article>
      </div>
      <app-table-map
        class="public-map"
        [tables]="mapTables()"
        [sectionColors]="d.sectionMapColors || {}"
        [interactive]="false"
      ></app-table-map>
    </div>

    <ng-template #listView>
      <div class="mt-3 grid gap-2">
        <label class="grid gap-1 text-xs text-brand-600">
          Search table
          <input
            type="text"
            class="h-10 rounded-lg border border-brand-200 px-3 text-base md:text-sm"
            [formControl]="search"
            placeholder="A01, B38..."
            inputmode="text"
          />
        </label>

        <div class="grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5">
          <article
            class="rounded-xl border p-2"
            [ngClass]="item.available ? 'border-success-300 bg-success-50' : 'border-brand-200 bg-brand-50 text-brand-500'"
            *ngFor="let item of filteredTables()"
          >
            <p class="text-base font-semibold">{{ item.id }}</p>
            <p class="text-[11px] uppercase tracking-[0.14em]">{{ item.available ? 'Available' : 'Unavailable' }}</p>
            <p class="mt-1 text-xs">Section {{ item.section }} · ${{ item.price }}</p>
          </article>
        </div>
      </div>
    </ng-template>
  </section>

  <article class="mt-3 rounded-2xl border border-brand-100 bg-brand-50 p-3 text-sm text-brand-700">
    <p class="font-semibold text-brand-900">How to reserve</p>
    <p class="mt-1">Reply with your table number. Staff will place a short hold and send a payment link.</p>
  </article>

  <p class="mt-4 text-sm text-brand-500" *ngIf="loading">Loading availability…</p>
  <p class="mt-4 rounded-xl border border-danger-200 bg-danger-50 p-3 text-sm text-danger-700" *ngIf="error">{{ error }}</p>
</section>
