<section class="page">
  <header class="page-header">
    <h1>Clients CRM</h1>
    <p>All customers who have reserved, with totals and last visit.</p>
  </header>

  <section class="card">
    <div class="filters">
      <label>
        Search
        <input type="text" [formControl]="filterQuery" placeholder="Name or phone" />
      </label>
      <button type="button" (click)="load()" [disabled]="loading">Refresh</button>
    </div>

    <div *ngIf="loading" class="muted">Loading…</div>
    <div *ngIf="!loading && filteredItems().length === 0" class="muted">No clients.</div>
    <p class="error" *ngIf="error">{{ error }}</p>

    <table *ngIf="filteredItems().length > 0">
      <thead>
        <tr>
          <th>Name</th>
          <th>Phone</th>
          <th>Total Spend</th>
          <th>Reservations</th>
          <th>Last Event</th>
          <th>Last Table</th>
          <th>Updated By</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of filteredItems()">
          <td>{{ c.name }}</td>
          <td>{{ c.phone }}</td>
          <td>${{ formatMoney(c.totalSpend) }}</td>
          <td>{{ c.totalReservations || 0 }}</td>
          <td>{{ c.lastEventDate || '—' }}</td>
          <td>{{ c.lastTableId || '—' }}</td>
          <td>{{ c.updatedBy || '—' }}</td>
        </tr>
      </tbody>
    </table>
  </section>
</section>
