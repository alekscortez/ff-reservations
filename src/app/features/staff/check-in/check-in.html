<section class="mx-auto grid w-full max-w-4xl gap-4 px-3 pb-20 pt-3 md:px-5">
  <header class="rounded-2xl border border-brand-100 bg-white p-4 md:p-5">
    <h1 class="text-2xl font-semibold text-brand-900 md:text-3xl">Check-In</h1>
    <p class="mt-1 text-sm text-brand-600">Validate entry at the door by scanning check-in passes.</p>
  </header>

  <article class="rounded-2xl border border-brand-100 bg-white p-4 md:p-5">
    <h2 class="text-sm font-semibold uppercase tracking-[0.12em] text-brand-500">Pass Management</h2>
    <p class="mt-2 text-sm text-brand-600">
      Issue or reissue check-in passes from Reservation Details or Dashboard where the reservation is already selected.
    </p>
  </article>

  <article class="rounded-2xl border border-brand-100 bg-white p-4 md:p-5">
    <h2 class="text-sm font-semibold uppercase tracking-[0.12em] text-brand-500">Scanner</h2>
    <p class="mt-1 text-sm text-brand-600">
      Use camera scan for fastest check-in. Scans are verified automatically.
    </p>

    <div class="mt-3 grid gap-3 rounded-xl border border-brand-100 bg-brand-50 p-3">
      <div class="flex flex-wrap items-center gap-2">
        <button
          type="button"
          class="h-10 rounded-lg bg-brand-900 px-3 text-sm font-semibold text-white disabled:opacity-60"
          (click)="startScanner()"
          [disabled]="!scannerSupported || scannerActive"
        >
          Start Camera
        </button>
        <button
          type="button"
          class="h-10 rounded-lg border border-brand-200 px-3 text-sm font-semibold text-brand-900 disabled:opacity-60"
          (click)="stopScanner()"
          [disabled]="!scannerActive"
        >
          Stop
        </button>
        <button
          type="button"
          class="h-10 rounded-lg border border-brand-200 px-3 text-sm font-semibold text-brand-900 disabled:opacity-60"
          (click)="toggleCameraFacing()"
          [disabled]="!scannerSupported"
        >
          Flip Camera
        </button>
        <span
          class="rounded-full border px-2 py-1 text-[11px] font-semibold"
          [ngClass]="scannerActive ? 'border-success-300 bg-success-100 text-success-800' : 'border-brand-200 bg-white text-brand-600'"
        >
          {{ scannerActive ? 'Camera Active' : 'Camera Off' }}
        </span>
      </div>

      <p class="text-xs text-brand-600" *ngIf="!scannerSupported">
        Camera scanning is not supported on this browser. Use manual input below.
      </p>
      <p class="text-xs text-danger-700" *ngIf="scannerError">{{ scannerError }}</p>

      <div class="overflow-hidden rounded-lg border border-brand-200 bg-black" *ngIf="scannerSupported">
        <video
          #scannerVideo
          class="h-56 w-full object-cover md:h-72"
          playsinline
          muted
        ></video>
      </div>
    </div>

    <div class="mt-3 rounded-xl border p-3 text-sm" *ngIf="verifyResult" [ngClass]="resultBadgeClass()">
      <div class="flex flex-wrap items-center gap-2">
        <span class="rounded-full border px-2 py-0.5 text-xs font-semibold">{{ verifyResult.code }}</span>
        <span class="font-semibold">{{ verifyResult.message }}</span>
      </div>
      <p class="mt-2 text-xs">
        Reservation {{ verifyResult.reservation?.reservationId }} ·
        Table {{ verifyResult.reservation?.tableId }} ·
        {{ verifyResult.reservation?.customerName }}
      </p>
      <p class="mt-1 text-xs" *ngIf="verifyResult.pass?.usedAt">
        Used at epoch {{ verifyResult.pass?.usedAt }} by {{ verifyResult.pass?.usedBy }}
      </p>
    </div>
  </article>

  <p class="rounded-lg border border-danger-200 bg-danger-50 px-3 py-2 text-sm text-danger-700" *ngIf="error">
    {{ error }}
  </p>
  <p class="rounded-lg border border-success-200 bg-success-50 px-3 py-2 text-sm text-success-700" *ngIf="notice">
    {{ notice }}
  </p>
</section>
